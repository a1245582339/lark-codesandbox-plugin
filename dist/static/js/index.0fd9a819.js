(()=>{"use strict";var e,t,n,r,s,l={123(e,t,n){var r=n(70),s=n(758),l=n(576),i=n(864),a=n(878),o=n(497);async function c(){let e=new Promise((e,t)=>{setTimeout(()=>t(Error("SDK 初始化超时")),3e3)}),t=o.UV.base.getSelection();return await Promise.race([t,e]),o.UV}async function d(e){let t=await fetch(e);return await t.text()}let u=[{name:"React",type:"react",extensions:[".jsx",".tsx"],baseDeps:["react","react-dom","react/jsx-runtime","tailwindcss","postcss","autoprefixer"],defaultDeps:["react","react-dom","tailwindcss"],createFiles(e,t,n){let r=t.endsWith(".tsx"),s=t.replace(/\.(jsx|tsx)$/,""),l={react:"^18.2.0","react-dom":"^18.2.0"};n.forEach(e=>{l[e]="latest"});let i={"@rsbuild/core":"^1.0.0","@rsbuild/plugin-react":"^1.0.0","@rspack/binding-wasm32-wasi":"^1.0.0",tailwindcss:"^3.4.0",postcss:"^8.4.0",autoprefixer:"^10.4.0",...r?{typescript:"^5.3.0","@types/react":"^18.2.0","@types/react-dom":"^18.2.0"}:{}},a=`import { defineConfig } from '@rsbuild/core';
import { pluginReact } from '@rsbuild/plugin-react';

export default defineConfig({
  plugins: [pluginReact()],
});`,o=`/** @type {import('tailwindcss').Config} */
export default {
  content: ['./src/**/*.{js,jsx,ts,tsx}'],
  theme: {
    extend: {},
  },
  plugins: [],
};`,c=`export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};`,d=`@tailwind base;
@tailwind components;
@tailwind utilities;`,u=`import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import ${s} from './${t}';

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <${s} />
  </React.StrictMode>
);`;return{"package.json":{file:{contents:JSON.stringify({name:"react-preview",type:"module",scripts:{dev:"rsbuild dev",build:"rsbuild build",preview:"rsbuild preview"},dependencies:l,devDependencies:i},null,2)}},".npmrc":{file:{contents:"store-dir=.local/share/pnpm/store"}},"rsbuild.config.mjs":{file:{contents:a}},"tailwind.config.js":{file:{contents:o}},"postcss.config.mjs":{file:{contents:c}},src:{directory:{"index.tsx":{file:{contents:u}},"index.css":{file:{contents:d}},[t]:{file:{contents:e}}}}}},getEditorLanguage:e=>e.endsWith(".tsx")?"typescript":"javascript"},{name:"Vue 3",type:"vue",extensions:[".vue"],baseDeps:["vue","tailwindcss","postcss","autoprefixer"],defaultDeps:["vue","tailwindcss"],createFiles(e,t,n){let r=t.replace(/\.vue$/,""),s={vue:"^3.4.0"};n.forEach(e=>{s[e]="latest"});let l=`import { defineConfig } from '@rsbuild/core';
import { pluginVue } from '@rsbuild/plugin-vue';

export default defineConfig({
  plugins: [pluginVue()],
});`,i=`/** @type {import('tailwindcss').Config} */
export default {
  content: ['./src/**/*.{js,ts,vue}'],
  theme: {
    extend: {},
  },
  plugins: [],
};`,a=`export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};`,o=`@tailwind base;
@tailwind components;
@tailwind utilities;`,c=`import { createApp } from 'vue';
import './index.css';
import ${r} from './${t}';

createApp(${r}).mount('#root');`;return{"package.json":{file:{contents:JSON.stringify({name:"vue-preview",type:"module",scripts:{dev:"rsbuild dev",build:"rsbuild build",preview:"rsbuild preview"},dependencies:s,devDependencies:{"@rsbuild/core":"^1.0.0","@rsbuild/plugin-vue":"^1.0.0","@rspack/binding-wasm32-wasi":"^1.0.0",tailwindcss:"^3.4.0",postcss:"^8.4.0",autoprefixer:"^10.4.0"}},null,2)}},".npmrc":{file:{contents:"store-dir=.local/share/pnpm/store"}},"rsbuild.config.mjs":{file:{contents:l}},"tailwind.config.js":{file:{contents:i}},"postcss.config.mjs":{file:{contents:a}},src:{directory:{"index.js":{file:{contents:c}},"index.css":{file:{contents:o}},[t]:{file:{contents:e}}}}}},getEditorLanguage:e=>"html"},{name:"Svelte",type:"svelte",extensions:[".svelte"],baseDeps:["svelte","tailwindcss","postcss","autoprefixer"],defaultDeps:["svelte","tailwindcss"],createFiles(e,t,n){let r=t.replace(/\.svelte$/,""),s={};n.forEach(e=>{s[e]="latest"});let l={name:"svelte-preview",type:"module",scripts:{dev:"rsbuild dev",build:"rsbuild build",preview:"rsbuild preview"},dependencies:Object.keys(s).length>0?s:void 0,devDependencies:{"@rsbuild/core":"^1.0.0","@rsbuild/plugin-svelte":"^1.0.0","@rspack/binding-wasm32-wasi":"^1.0.0",svelte:"^4.2.0",tailwindcss:"^3.4.0",postcss:"^8.4.0",autoprefixer:"^10.4.0"}};l.dependencies||delete l.dependencies;let i=`import { defineConfig } from '@rsbuild/core';
import { pluginSvelte } from '@rsbuild/plugin-svelte';

export default defineConfig({
  plugins: [pluginSvelte()],
});`,a=`/** @type {import('tailwindcss').Config} */
export default {
  content: ['./src/**/*.{html,js,svelte}'],
  theme: {
    extend: {},
  },
  plugins: [],
};`,o=`export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};`,c=`@tailwind base;
@tailwind components;
@tailwind utilities;`,d=`import './index.css';
import ${r} from './${t}';

const app = new ${r}({
  target: document.getElementById('root'),
});

export default app;`;return{"package.json":{file:{contents:JSON.stringify(l,null,2)}},".npmrc":{file:{contents:"store-dir=.local/share/pnpm/store"}},"rsbuild.config.mjs":{file:{contents:i}},"tailwind.config.js":{file:{contents:a}},"postcss.config.mjs":{file:{contents:o}},src:{directory:{"index.js":{file:{contents:d}},"index.css":{file:{contents:c}},[t]:{file:{contents:e}}}}}},getEditorLanguage:e=>"html"}],m=u.flatMap(e=>e.extensions);function p(e){let t=e.toLowerCase();for(let e of u)if(e.extensions.some(e=>t.endsWith(e)))return{type:e.type,adapter:e};return null}function f(e){let t=e.toLowerCase();return m.some(e=>t.endsWith(e))}let x="component-preview-file-history",g=["example/生死簿后台管理系统.tsx.template","example/tinder.vue.template","example/死了么.svelte.template"];function h(){return`${Date.now()}-${Math.random().toString(36).substring(2,9)}`}function b(e){try{let t=e.slice(0,20);localStorage.setItem(x,JSON.stringify(t))}catch(e){console.error("Failed to save file history:",e)}}function v(e,t,n,r){return r?n.map(e=>e.id===r?{...e,content:t,timestamp:Date.now()}:e):[{id:h(),name:e,content:t,timestamp:Date.now()},...n]}async function y(){let e=[];for(let t of g)try{let n=await fetch(t);if(n.ok){let r=await n.text(),s=(t.split("/").pop()||t).replace(/\.template$/,"");e.push({id:h(),name:s,content:r,timestamp:Date.now()})}}catch(e){console.error(`Failed to load example file: ${t}`,e)}return e}let j=()=>(0,r.jsx)("svg",{viewBox:"0 0 24 24",className:"w-4 h-4",fill:"#61DAFB",children:(0,r.jsx)("path",{d:"M12 10.11c1.03 0 1.87.84 1.87 1.89 0 1-.84 1.85-1.87 1.85S10.13 13 10.13 12c0-1.05.84-1.89 1.87-1.89M7.37 20c.63.38 2.01-.2 3.6-1.7-.52-.59-1.03-1.23-1.51-1.9a22.7 22.7 0 01-2.4-.36c-.51 2.14-.32 3.61.31 3.96m.71-5.74l-.29-.51c-.11.29-.22.58-.29.86.27.06.57.11.88.16l-.3-.51m6.54-.76l.81-1.5-.81-1.5c-.3-.53-.62-1-.91-1.47C13.17 9 12.6 9 12 9s-1.17 0-1.71.03c-.29.47-.61.94-.91 1.47L8.57 12l.81 1.5c.3.53.62 1 .91 1.47.54.03 1.11.03 1.71.03s1.17 0 1.71-.03c.29-.47.61-.94.91-1.47M12 6.78c-.19.22-.39.45-.59.72h1.18c-.2-.27-.4-.5-.59-.72m0 10.44c.19-.22.39-.45.59-.72h-1.18c.2.27.4.5.59.72M16.62 4c-.62-.38-2 .2-3.59 1.7.52.59 1.03 1.23 1.51 1.9.82.08 1.63.2 2.4.36.51-2.14.32-3.61-.32-3.96m-.7 5.74l.29.51c.11-.29.22-.58.29-.86-.27-.06-.57-.11-.88-.16l.3.51m1.45-7.05c1.47.84 1.63 3.05 1.01 5.63 2.54.75 4.37 1.99 4.37 3.68s-1.83 2.93-4.37 3.68c.62 2.58.46 4.79-1.01 5.63-1.46.84-3.45-.12-5.37-1.95-1.92 1.83-3.91 2.79-5.38 1.95-1.46-.84-1.62-3.05-1-5.63-2.54-.75-4.37-1.99-4.37-3.68s1.83-2.93 4.37-3.68c-.62-2.58-.46-4.79 1-5.63 1.47-.84 3.46.12 5.38 1.95 1.92-1.83 3.91-2.79 5.37-1.95M17.08 12c.34.75.64 1.5.89 2.26 2.1-.63 3.28-1.53 3.28-2.26s-1.18-1.63-3.28-2.26c-.25.76-.55 1.51-.89 2.26M6.92 12c-.34-.75-.64-1.5-.89-2.26-2.1.63-3.28 1.53-3.28 2.26s1.18 1.63 3.28 2.26c.25-.76.55-1.51.89-2.26m9 2.26l-.3.51c.31-.05.61-.1.88-.16-.07-.28-.18-.57-.29-.86l-.29.51m-2.89 4.04c1.59 1.5 2.97 2.08 3.59 1.7.64-.35.83-1.82.32-3.96-.77.16-1.58.28-2.4.36-.48.67-.99 1.31-1.51 1.9M8.08 9.74l.3-.51c-.31.05-.61.1-.88.16.07.28.18.57.29.86l.29-.51m2.89-4.04C9.38 4.2 8 3.62 7.37 4c-.63.35-.82 1.82-.31 3.96a22.7 22.7 0 012.4-.36c.48-.67.99-1.31 1.51-1.9z"})}),w=()=>(0,r.jsx)("svg",{viewBox:"0 0 24 24",className:"w-4 h-4",fill:"#4FC08D",children:(0,r.jsx)("path",{d:"M2 3h3.5L12 15l6.5-12H22L12 21 2 3m4.5 0h3L12 7.58 14.5 3h3L12 13.08 6.5 3z"})}),N=()=>(0,r.jsx)("svg",{viewBox:"0 0 24 24",className:"w-4 h-4",fill:"#FF3E00",children:(0,r.jsx)("path",{d:"M20.58 6.75c-1.77-2.65-5.37-3.43-8.1-1.87l-4.17 2.4a5.43 5.43 0 00-2.47 3.37 5.1 5.1 0 00.53 3.85 5.05 5.05 0 00-1.2 1.93 5.21 5.21 0 00.87 5.07c1.77 2.65 5.37 3.43 8.1 1.87l4.17-2.4a5.43 5.43 0 002.47-3.37 5.1 5.1 0 00-.53-3.85 5.05 5.05 0 001.2-1.93 5.21 5.21 0 00-.87-5.07zM9.77 20.41a3.37 3.37 0 01-3.63-1.2 3.08 3.08 0 01-.53-2.31c.03-.18.08-.36.15-.53l.12-.3.31.19a6.13 6.13 0 001.87 1.05l.18.06-.02.18a.93.93 0 00.18.62 1.01 1.01 0 001.09.36.97.97 0 00.36-.17l4.17-2.4a.9.9 0 00.4-.56.86.86 0 00-.13-.66 1.01 1.01 0 00-1.09-.36.97.97 0 00-.36.17l-1.59.92a3.23 3.23 0 01-1.18.53 3.37 3.37 0 01-3.63-1.2 3.08 3.08 0 01-.53-2.31 3.1 3.1 0 011.41-2.06l4.17-2.4a3.23 3.23 0 011.18-.53 3.37 3.37 0 013.63 1.2 3.08 3.08 0 01.53 2.31c-.03.18-.08.36-.15.53l-.12.3-.31-.19a6.13 6.13 0 00-1.87-1.05l-.18-.06.02-.18a.93.93 0 00-.18-.62 1.01 1.01 0 00-1.09-.36.97.97 0 00-.36.17l-4.17 2.4a.9.9 0 00-.4.56.86.86 0 00.13.66 1.01 1.01 0 001.09.36.97.97 0 00.36-.17l1.59-.92a3.23 3.23 0 011.18-.53 3.37 3.37 0 013.63 1.2 3.08 3.08 0 01.53 2.31 3.1 3.1 0 01-1.41 2.06l-4.17 2.4a3.23 3.23 0 01-1.18.53z"})}),k=e=>{var t,n,l;let o,{files:c,setFiles:u,isInBitable:g}=e,[h,k]=(0,s.useState)(null),[S,C]=(0,s.useState)(""),[E,R]=(0,s.useState)(!1),[O,M]=(0,s.useState)(null),[$,D]=(0,s.useState)(400),[F,L]=(0,s.useState)(""),[B,V]=(0,s.useState)(()=>g?[]:function(){try{let e=localStorage.getItem(x);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load file history:",e)}return[]}()),[I,T]=(0,s.useState)(null),A=(0,s.useRef)(null),W=(0,s.useRef)(null),P=(0,s.useRef)(null),z=(0,s.useRef)(new Map),U=(0,s.useRef)(null),J=(0,s.useRef)(!1);(0,s.useEffect)(()=>{let e=()=>{if(P.current){let e=P.current.getBoundingClientRect();D(Math.max(300,window.innerHeight-e.top-16))}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[S,E]);let _=async e=>{let t=e.target.files;if(!t||0===t.length)return;let n=[];for(let e of(z.current.clear(),Array.from(t)))if(f(e.name)){let t=await e.text(),r=`local-${Date.now()}-${e.name}`;z.current.set(r,t),n.push({name:e.name,url:"",token:r,type:e.type})}u(n),W.current&&(W.current.value="")},K=function(e){let t=e.filter(e=>f(e.name));if(0===t.length)return{valid:!1,error:`缺少组件文件：请上传 ${m.join(", ")} 文件`};let n=t[0],r=p(n.name);return r?{valid:!0,componentFile:n,frameworkName:r.adapter.name}:{valid:!1,error:`不支持的文件类型: ${n.name}`}}(c);(0,s.useEffect)(()=>{if(c.length>0&&K.valid&&K.componentFile){let e=K.componentFile;((null==h?void 0:h.token)!==e.token||(null==h?void 0:h.url)!==e.url)&&(k(e),L(K.frameworkName||""),T(null))}},[c,K.valid,null==(t=K.componentFile)?void 0:t.token,null==(n=K.componentFile)?void 0:n.url]);let H=(0,s.useRef)("");(0,s.useEffect)(()=>{if(!h){H.current="";return}if(h.token!==H.current){if(h.token.startsWith("history-")){H.current=h.token;return}(async()=>{try{let e;if(R(!0),M(null),e=h.token.startsWith("local-")?z.current.get(h.token)||"":await d(h.url),C(e),H.current=h.token,e&&!g){let t=v(h.name,e,B);V(t),b(t),T(t[0].id)}}catch(e){M(e instanceof Error?e.message:"加载失败")}finally{R(!1)}})()}},[h]);let q=(0,s.useCallback)(e=>{C(e.content),T(e.id);let t=p(e.name);t&&L(t.adapter.name);let n={name:e.name,url:"",token:`history-${e.id}`,type:""};k(n),H.current=n.token},[]),G=(0,s.useCallback)((e,t)=>{t.stopPropagation();let n=B.filter(t=>t.id!==e);V(n),b(n),I===e&&(T(null),C(""),k(null))},[B,I]),Q=(0,s.useRef)(!1);(0,s.useEffect)(()=>{g||Q.current||c.length>0||(async()=>{if(Q.current=!0,B.length>0)q(B[0]);else{let e=await y();e.length>0&&(V(e),b(e),q(e[0]))}})()},[g,c.length,B,q]),(0,s.useEffect)(()=>()=>{A.current&&!A.current.closed&&A.current.close()},[]);let X=(0,s.useRef)(null),Y=m.join(", ");return 0===c.length&&0===B.length?(0,r.jsxs)("div",{className:"flex flex-col gap-3 flex-1",children:[(0,r.jsx)("input",{ref:W,type:"file",accept:m.join(","),onChange:_,className:"hidden"}),g?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[300px] text-center bg-white rounded-lg border border-dashed border-gray-300 gap-2",children:[(0,r.jsx)("div",{className:"text-5xl mb-2",children:"\uD83D\uDCCE"}),(0,r.jsx)("h3",{className:"text-base font-semibold text-gray-800",children:"请选择附件字段"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["选择包含 ",Y," 文件的附件单元格"]})]}):(0,r.jsxs)("div",{onClick:()=>{var e;return null==(e=W.current)?void 0:e.click()},className:"flex flex-col items-center justify-center min-h-[300px] text-center bg-white rounded-lg border border-dashed border-gray-300 gap-2 cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-colors",children:[(0,r.jsx)("div",{className:"text-5xl mb-2",children:"\uD83D\uDCE4"}),(0,r.jsx)("h3",{className:"text-base font-semibold text-gray-800",children:"点击上传文件"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["支持 ",Y," 文件"]})]})]}):K.valid||I?(0,r.jsxs)("div",{className:"flex flex-col gap-3 flex-1",children:[O&&(0,r.jsx)("div",{className:"px-3 py-2.5 bg-red-50 border border-red-200 rounded-md text-sm text-red-600",children:O}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>{let e;if(!S||!h)return;A.current&&!A.current.closed&&A.current.close();let t=JSON.stringify({code:S,fileName:h.name,fromParent:!0}),n=(0,a.compressToEncodedURIComponent)(t),r=new URL("./preview.html",window.location.href).href,s=r+"#c="+n;if(s.length<=6e4)J.current=!0,U.current=null,e=s;else{J.current=!1;let n=`preview-${Date.now()}`;U.current=n,localStorage.setItem(n,t),e=r+"#"+n}A.current=window.open(e,"component-preview","width=1200,height=800")},disabled:!S||E,className:"flex-1 py-3 text-base font-medium text-white bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed rounded-lg cursor-pointer transition-colors flex items-center justify-center gap-2",children:E?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"正在加载..."]}):(0,r.jsx)(r.Fragment,{children:"在新窗口预览"})}),!g&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{ref:W,type:"file",accept:m.join(","),onChange:_,className:"hidden"}),(0,r.jsx)("button",{onClick:()=>{var e;return null==(e=W.current)?void 0:e.click()},className:"px-4 py-3 text-base font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-lg cursor-pointer transition-colors",children:"上传新文件"})]})]}),(0,r.jsxs)("div",{className:"px-4 py-3 bg-blue-50 border border-blue-200 rounded-md",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"使用说明"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1 list-disc list-inside",children:[(0,r.jsx)("li",{children:"支持 React (.jsx/.tsx)、Vue 3 (.vue)、Svelte (.svelte)"}),(0,r.jsx)("li",{children:"目前只支持单文件组件，不支持文件间引用"}),(0,r.jsx)("li",{children:"请确保额外依赖都在组件顶部通过 import 引入"}),(0,r.jsx)("li",{children:"首次打开需要等待环境初始化（约30秒-1分钟）"})]}),(0,r.jsxs)("h4",{className:"text-sm font-medium text-blue-800 mt-3 mb-2",children:["当前框架: ",F," | 预装依赖"]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-1.5",children:("React"===F?["react","react-dom","tailwindcss"]:"Vue 3"===F?["vue","tailwindcss"]:["svelte","tailwindcss"]).map(e=>(0,r.jsx)("span",{className:"px-2 py-0.5 text-xs font-mono bg-blue-100 text-blue-700 rounded",children:e},e))}),(0,r.jsx)("p",{className:"text-xs text-blue-600 mt-2",children:"其他依赖会根据代码中的 import 自动安装"})]}),S&&!E&&(0,r.jsxs)("div",{ref:P,className:"bg-white rounded-lg border border-gray-200 overflow-hidden flex",children:[!g&&(0,r.jsxs)("div",{className:"w-52 bg-[#252526] border-r border-[#3c3c3c] flex flex-col",children:[(0,r.jsxs)("div",{className:"px-3 py-2 text-xs text-gray-400 uppercase tracking-wide flex items-center justify-between",children:[(0,r.jsx)("span",{children:"历史文件"}),(0,r.jsx)("span",{className:"text-[10px] bg-gray-600 px-1.5 rounded",children:B.length})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===B.length?(0,r.jsx)("div",{className:"px-3 py-2 text-xs text-gray-500",children:"暂无历史文件"}):B.map(e=>{let t=I===e.id,n=p(e.name);return(0,r.jsxs)("div",{onClick:()=>q(e),className:`group flex items-center gap-2 px-3 py-1.5 text-sm cursor-pointer hover:bg-[#2a2d2e] ${t?"bg-[#37373d] text-white":"text-gray-300"}`,children:[(0,r.jsx)("span",{className:"flex-shrink-0",children:function(e){switch(e){case"react":return(0,r.jsx)(j,{});case"vue":return(0,r.jsx)(w,{});case"svelte":return(0,r.jsx)(N,{});default:return(0,r.jsx)("span",{className:"w-4 h-4 text-center",children:"\uD83D\uDCC4"})}}(null==n?void 0:n.adapter.type)}),(0,r.jsx)("span",{className:"truncate flex-1",title:e.name,children:e.name}),(0,r.jsx)("button",{onClick:t=>G(e.id,t),className:"opacity-0 group-hover:opacity-100 text-gray-500 hover:text-red-400 transition-opacity",title:"删除",children:"✕"})]},e.id)})})]}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center px-3 py-1.5 bg-[#2d2d2d] border-b border-[#3c3c3c]",children:[(0,r.jsx)("span",{className:"text-sm text-gray-300",children:null==h?void 0:h.name}),F&&(0,r.jsx)("span",{className:"ml-2 px-2 py-0.5 text-xs bg-blue-600 text-white rounded",children:F})]}),(0,r.jsx)(i.Ay,{height:`${$}px`,language:h?(o=p(l=h.name))?o.adapter.getEditorLanguage(l):l.endsWith(".tsx")||l.endsWith(".ts")?"typescript":"javascript":"javascript",theme:"vs-dark",value:S,onChange:e=>{let t=e||"";C(t);if(A.current&&!A.current.closed&&h&&A.current.postMessage({type:"code-update",code:t,fileName:h.name},"*"),h){if(J.current&&A.current&&!A.current.closed){let e=JSON.stringify({code:t,fileName:h.name,fromParent:!0}),n=(0,a.compressToEncodedURIComponent)(e);(new URL("./preview.html",window.location.href).href+"#c="+n).length<=6e4&&(A.current.location.hash="#c="+n)}else if(U.current){let e=JSON.stringify({code:t,fileName:h.name});localStorage.setItem(U.current,e)}}!g&&h&&I&&(X.current&&clearTimeout(X.current),X.current=setTimeout(()=>{let e=v(h.name,t,B,I);V(e),b(e)},500))},beforeMount:e=>{e.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!0,noSyntaxValidation:!0}),e.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!0,noSyntaxValidation:!0})},options:{minimap:{enabled:!1},fontSize:13,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:2,find:{addExtraSpaceOnTop:!1,autoFindInSelection:"never",seedSearchStringFromSelection:"selection"}},onMount:e=>{e.addCommand(2084,()=>{var t;null==(t=e.getAction("actions.find"))||t.run()})}})]})]})]}):(0,r.jsxs)("div",{className:"flex flex-col gap-3 flex-1",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[300px] text-center bg-white rounded-lg border border-dashed border-red-300 gap-2",children:[(0,r.jsx)("div",{className:"text-5xl mb-2",children:"⚠️"}),(0,r.jsx)("h3",{className:"text-base font-semibold text-red-600",children:"文件验证失败"}),(0,r.jsx)("p",{className:"text-sm text-red-500 max-w-[280px]",children:K.error})]}),(0,r.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border border-gray-200 rounded-md",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"当前附件文件："}),(0,r.jsx)("ul",{className:"text-sm text-gray-600 space-y-1",children:c.map(e=>(0,r.jsx)("li",{className:"flex items-center gap-2",children:(0,r.jsxs)("span",{className:f(e.name)?"text-green-600 font-medium":"text-gray-500",children:["\uD83D\uDCC4 ",e.name]})},e.token))})]}),(0,r.jsxs)("div",{className:"px-4 py-3 bg-blue-50 border border-blue-200 rounded-md",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"支持的框架"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1 list-disc list-inside",children:[(0,r.jsx)("li",{children:"React: .jsx, .tsx 文件"}),(0,r.jsx)("li",{children:"Vue 3: .vue 文件"}),(0,r.jsx)("li",{children:"Svelte: .svelte 文件"})]})]})]})},S=document.getElementById("root");S&&l.createRoot(S).render((0,r.jsx)(s.StrictMode,{children:(0,r.jsx)(()=>{let[e,t]=(0,s.useState)([]),[n,l]=(0,s.useState)(!1),[i,a]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{let e=e=>{(e.ctrlKey||e.metaKey)&&"f"===e.key&&e.preventDefault()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]),(0,s.useEffect)(()=>{(async()=>{try{await c(),l(!0),a(!0),function(e){let t=null,n="",r=null;async function s(e,t,n){try{let r=await o.UV.base.getTableById(e),s=await r.getFieldById(n),l=await s.getType();if(17!==l)return[];let i=await s.getValue(t);if(!i||0===i.length)return[];let a=i.filter(e=>{let t=e.name.toLowerCase();return t.endsWith(".jsx")||t.endsWith(".tsx")||t.endsWith(".vue")||t.endsWith(".svelte")});if(0===a.length)return[];let c=await s.getAttachmentUrls(t),d=new Map;return c.forEach((e,t)=>{i[t]&&d.set(i[t].token,e)}),a.map(e=>({name:e.name,url:d.get(e.token)||"",token:e.token,type:e.type}))}catch(e){return console.error("[Bitable] Error reading attachment field:",e),[]}}function l(e){return e.map(e=>`${e.token}:${e.name}`).sort().join("|")}async function i(){if(!t)return;let{tableId:r,recordId:i,fieldId:a}=t,o=await s(r,i,a),c=l(o);c!==n&&(console.log("[Bitable] Files changed:",o.map(e=>e.name)),n=c,e(o))}function a(){r&&(clearInterval(r),r=null)}o.UV.base.onSelectionChange(async o=>{let{fieldId:c,recordId:d,tableId:u}=o.data;if(console.log("[Bitable] Selection changed:",{fieldId:c,recordId:d,tableId:u}),!c||!d||!u){console.log("[Bitable] Missing selection data, clearing"),t=null,n="",a(),e([]);return}t={tableId:u,recordId:d,fieldId:c};let m=await s(u,d,c),p=l(m);console.log("[Bitable] Files:",m.map(e=>e.name)),n=p,e(m),a(),r=setInterval(i,2e3)})}(e=>{console.log("[App] Received files:",e.map(e=>e.name)),t(e)})}catch(e){console.error("Failed to initialize Bitable SDK:",e),a(!1),l(!0)}})()},[]),n)?(0,r.jsxs)("div",{className:"flex flex-col min-h-screen p-4 bg-gray-100 font-sans",children:[(0,r.jsx)("header",{className:"mb-4",children:(0,r.jsx)("p",{className:"text-sm text-gray-500",children:i?"选择附件字段中的组件文件进行实时预览 (支持 React / Vue / Svelte)":"上传组件文件进行实时预览 (支持 React / Vue / Svelte)"})}),(0,r.jsx)("main",{className:"flex-1 flex flex-col",children:(0,r.jsx)(k,{files:e,setFiles:t,isInBitable:i})})]}):(0,r.jsx)("div",{className:"flex flex-col min-h-screen p-4 bg-gray-100 font-sans",children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[300px] gap-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 border-3 border-gray-200 border-t-blue-500 rounded-full animate-spin"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"正在初始化..."})]})})},{})}))}},i={};function a(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={id:e,loaded:!1,exports:{}};return l[e](n,n.exports,a),n.loaded=!0,n.exports}a.m=l,a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,n)=>(a.f[n](e,t),t),[])),a.u=e=>"static/js/async/"+e+".925ccc17.js",a.miniCssF=e=>""+e+".css",a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},a.l=function(t,n,r,s){if(e[t])return void e[t].push(n);if(void 0!==r)for(var l,i,o=document.getElementsByTagName("script"),c=0;c<o.length;c++){var d=o[c];if(d.getAttribute("src")==t||d.getAttribute("data-rspack")=="lark-codesandbox-plugin:"+r){l=d;break}}l||(i=!0,(l=document.createElement("script")).timeout=120,a.nc&&l.setAttribute("nonce",a.nc),l.setAttribute("data-rspack","lark-codesandbox-plugin:"+r),l.src=t),e[t]=[n];var u=function(n,r){l.onerror=l.onload=null,clearTimeout(m);var s=e[t];if(delete e[t],l.parentNode&&l.parentNode.removeChild(l),s&&s.forEach(function(e){return e(r)}),n)return n(r)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=u.bind(null,l.onerror),l.onload=u.bind(null,l.onload),i&&document.head.appendChild(l)},a.r=e=>{"u">typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.nc=void 0,t=[],a.O=(e,n,r,s)=>{if(n){s=s||0;for(var l=t.length;l>0&&t[l-1][2]>s;l--)t[l]=t[l-1];t[l]=[n,r,s];return}for(var i=1/0,l=0;l<t.length;l++){for(var[n,r,s]=t[l],o=!0,c=0;c<n.length;c++)(!1&s||i>=s)&&Object.keys(a.O).every(e=>a.O[e](n[c]))?n.splice(c--,1):(o=!1,s<i&&(i=s));if(o){t.splice(l--,1);var d=r();void 0!==d&&(e=d)}}return e},a.p="./",n={410:0,649:0},a.f.j=function(e,t){var r=a.o(n,e)?n[e]:void 0;if(0!==r)if(r)t.push(r[2]);else if(649!=e){var s=new Promise((t,s)=>r=n[e]=[t,s]);t.push(r[2]=s);var l=a.p+a.u(e),i=Error();a.l(l,function(t){if(a.o(n,e)&&(0!==(r=n[e])&&(n[e]=void 0),r)){var s=t&&("load"===t.type?"missing":t.type),l=t&&t.target&&t.target.src;i.message="Loading chunk "+e+" failed.\n("+s+": "+l+")",i.name="ChunkLoadError",i.type=s,i.request=l,r[1](i)}},"chunk-"+e,e)}else n[e]=0},a.O.j=e=>0===n[e],r=(e,t)=>{var r,s,[l,i,o]=t,c=0;if(l.some(e=>0!==n[e])){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(o)var d=o(a)}for(e&&e(t);c<l.length;c++)s=l[c],a.o(n,s)&&n[s]&&n[s][0](),n[s]=0;return a.O(d)},(s=self.webpackChunklark_codesandbox_plugin=self.webpackChunklark_codesandbox_plugin||[]).forEach(r.bind(null,0)),s.push=r.bind(null,s.push.bind(s));var o=a.O(void 0,["783","239","649"],()=>a(123));o=a.O(o)})();