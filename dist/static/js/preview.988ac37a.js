(()=>{"use strict";var e,t,r,s,n={58(e,t,r){var s=r(70),n=r(758),i=r(576),l=r(305),a=r(809),o=r(627);r(382);let c=null,d=!1;async function u(){if(c)return c;if(d){for(;d;)await new Promise(e=>setTimeout(e,100));if(c)return c}d=!0;try{return c=await l.iM.boot()}finally{d=!1}}let f=["react","react-dom","react/jsx-runtime","tailwindcss","postcss","autoprefixer"],x=["react","react-dom","tailwindcss"],m=null;i.createRoot(document.getElementById("root")).render((0,s.jsx)(n.StrictMode,{children:(0,s.jsx)(()=>{let[e,t]=(0,n.useState)("idle"),[r,i]=(0,n.useState)("等待接收代码..."),[l,c]=(0,n.useState)([]),[d,p]=(0,n.useState)(null),[b,g]=(0,n.useState)(null),[h,w]=(0,n.useState)(!1),j=(0,n.useRef)(null),v=(0,n.useRef)(null),y=(0,n.useRef)(null),N=(0,n.useRef)(!1),C=(0,n.useRef)(null),O=(0,n.useCallback)(e=>{m&&(m.write(e.replace(/\n/g,"\r\n")),m.scrollToBottom())},[]),S=(0,n.useCallback)((e,r)=>{t(e),i(r)},[]),R=(0,n.useCallback)(e=>{c(t=>t.map(t=>({...t,status:e})))},[]),k=(0,n.useCallback)(()=>{C.current&&(C.current.src=C.current.src)},[]);(0,n.useEffect)(()=>{if(!j.current||m)return;let e=new a.Terminal({theme:{background:"#1e1e1e",foreground:"#d4d4d4",cursor:"#d4d4d4"},fontSize:13,fontFamily:"'SF Mono', 'Fira Code', Consolas, monospace",cursorBlink:!1,disableStdin:!0}),t=new o.Y;e.loadAddon(t),e.open(j.current),t.fit(),m=e,v.current=t,w(!0);let r=()=>t.fit();return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),e.dispose(),m=null}},[]),(0,n.useEffect)(()=>{if(!h||N.current)return;N.current=!0;let e=function(){let e=window.location.hash;if(!e||e.length<2)return null;try{let t=e.substring(1),r=decodeURIComponent(escape(atob(t)));return JSON.parse(r)}catch(e){return console.error("Failed to decode hash:",e),null}}();if(!e||!e.code){g("未能接收到代码，请关闭此窗口并重新点击预览按钮"),S("error","未收到代码");return}O(`收到代码: ${e.fileName}

`),$(e.code,e.fileName)},[h]);let $=async(e,t)=>{S("booting","正在分析依赖...");let r=function(e){let t,r=new Set,s=/import\s+(?:[\w\s{},*]+\s+from\s+)?['"]([^'"./][^'"]*)['"]/g;for(;null!==(t=s.exec(e));){let e=t[1];if(e.startsWith("@")){let t=e.split("/");e=t[0]+"/"+t[1]}else e=e.split("/")[0];r.add(e)}let n=/require\s*\(\s*['"]([^'"./][^'"]*)['"]\s*\)/g;for(;null!==(t=n.exec(e));){let e=t[1];if(e.startsWith("@")){let t=e.split("/");e=t[0]+"/"+t[1]}else e=e.split("/")[0];r.add(e)}return Array.from(r).filter(e=>!f.includes(e))}(e),s=[...x,...r];if(O("分析代码依赖...\n"),O(`默认依赖: ${x.join(", ")}
`),r.length>0&&O(`额外依赖: ${r.join(", ")}
`),O("\n"),c(s.map(e=>({name:e,status:"pending"}))),!window.crossOriginIsolated&&(S("booting","等待跨域隔离环境..."),await new Promise(e=>setTimeout(e,2e3)),!window.crossOriginIsolated)){g("浏览器环境不支持 WebContainers，请刷新页面重试"),S("error","环境不支持");return}try{let s,n,i,l,a,o,c,d,f;S("booting","正在启动 WebContainer..."),O("启动 WebContainer...\n");let x=await u();y.current=x,O("WebContainer 已启动\n\n"),S("booting","正在清理旧文件...");try{for(let e of(await x.fs.readdir("/")))await x.fs.rm(`/${e}`,{recursive:!0})}catch{}let{files:m}=(s=t.endsWith(".tsx"),n=t.replace(/\.(jsx|tsx)$/,""),i={react:"^18.2.0","react-dom":"^18.2.0"},r.forEach(e=>{i[e]="latest"}),l={"@rsbuild/core":"^1.0.0","@rsbuild/plugin-react":"^1.0.0",tailwindcss:"^3.4.0",postcss:"^8.4.0",autoprefixer:"^10.4.0",...s?{typescript:"^5.3.0","@types/react":"^18.2.0","@types/react-dom":"^18.2.0"}:{}},a=`import { defineConfig } from '@rsbuild/core';
import { pluginReact } from '@rsbuild/plugin-react';

export default defineConfig({
  plugins: [pluginReact()],
});`,o=`/** @type {import('tailwindcss').Config} */
export default {
  content: ['./src/**/*.{js,jsx,ts,tsx}'],
  theme: {
    extend: {},
  },
  plugins: [],
};`,c=`export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};`,d=`@tailwind base;
@tailwind components;
@tailwind utilities;`,f=`import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import ${n} from './${t}';

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <${n} />
  </React.StrictMode>
);`,{files:{"package.json":{file:{contents:JSON.stringify({name:"react-preview",type:"module",scripts:{dev:"rsbuild dev"},dependencies:i,devDependencies:l},null,2)}},"rsbuild.config.mjs":{file:{contents:a}},"tailwind.config.js":{file:{contents:o}},"postcss.config.mjs":{file:{contents:c}},src:{directory:{"index.tsx":{file:{contents:f}},"index.css":{file:{contents:d}},[t]:{file:{contents:e}}}}}});S("booting","正在创建项目文件..."),await x.mount(m),O("项目文件已创建\n\n"),S("installing","正在安装依赖..."),R("installing"),O("$ pnpm install\n");let b=await x.spawn("pnpm",["install"]);b.output.pipeTo(new WritableStream({write:e=>O(e)}));let g=await b.exit;if(0!==g)throw Error("依赖安装失败");R("installed"),O("\n"),S("running","正在启动开发服务器..."),O("$ pnpm run dev\n"),(await x.spawn("pnpm",["run","dev"])).output.pipeTo(new WritableStream({write:e=>O(e)})),x.on("server-ready",(e,t)=>{S("running","开发服务器已启动"),p(t)})}catch(e){console.error(e),g(e instanceof Error?e.message:"启动失败"),S("error","启动失败")}};return(0,s.jsxs)("div",{className:"flex flex-col min-h-screen bg-[#1e1e1e] text-white font-sans",children:[(0,s.jsxs)("header",{className:"flex items-center gap-3 px-4 py-3 bg-[#2d2d2d] border-b border-[#404040]",children:[(0,s.jsx)("h1",{className:"text-sm font-medium",children:"React 组件预览"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[(0,s.jsx)("div",{className:`w-2 h-2 rounded-full ${(()=>{switch(e){case"booting":case"installing":return"bg-amber-500";case"running":return"bg-emerald-500";case"error":return"bg-red-500";default:return"bg-gray-500"}})()}`}),(0,s.jsx)("span",{children:r})]})]}),(0,s.jsxs)("main",{className:"flex flex-1 min-h-0",children:[(0,s.jsxs)("div",{className:"w-[400px] flex flex-col bg-[#1e1e1e] border-r border-[#404040]",children:[(0,s.jsxs)("div",{className:"border-b border-[#404040]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 bg-[#2d2d2d] border-b border-[#404040]",children:[(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"\uD83D\uDCE6 依赖"}),(0,s.jsx)("span",{className:"px-2 py-0.5 text-[10px] bg-blue-500 text-white rounded-full",children:l.length})]}),(0,s.jsx)("div",{className:"px-3 py-2 max-h-[150px] overflow-auto",children:0===l.length?(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"没有额外依赖"}):l.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-2 py-1 text-xs font-mono",children:[(0,s.jsx)("span",{className:"text-blue-400",children:e.name}),(0,s.jsx)("span",{className:`ml-auto px-2 py-0.5 rounded text-[10px] ${(e=>{switch(e){case"pending":return"bg-gray-700 text-gray-400";case"installing":return"bg-amber-900 text-amber-400";case"installed":return"bg-emerald-900 text-emerald-400"}})(e.status)}`,children:(e=>{switch(e){case"pending":return"待安装";case"installing":return"安装中";case"installed":return"已安装"}})(e.status)})]},e.name))})]}),(0,s.jsxs)("div",{className:"flex flex-col flex-1 min-h-0",children:[(0,s.jsx)("div",{className:"px-3 py-2 bg-[#2d2d2d] border-b border-[#404040]",children:(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"⬛ 终端"})}),(0,s.jsx)("div",{ref:j,className:"flex-1 overflow-hidden"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 bg-[#2d2d2d] border-b border-[#404040]",children:[(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"预览"}),d&&(0,s.jsx)("button",{onClick:k,className:"px-2 py-1 text-xs text-gray-300 hover:text-white hover:bg-[#404040] rounded transition-colors",title:"刷新预览",children:"↻ 刷新"})]}),(0,s.jsx)("div",{className:"flex-1 relative",children:b?(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsx)("div",{className:"text-red-500 text-center px-5",children:b})}):d?(0,s.jsx)("iframe",{ref:C,src:d,className:"w-full h-full border-none bg-white"}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full gap-4",children:[(0,s.jsx)("div",{className:"w-8 h-8 border-3 border-[#404040] border-t-blue-500 rounded-full animate-spin"}),(0,s.jsx)("div",{className:"text-gray-400",children:r})]})})]})]})]})},{})}))}},i={};function l(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return n[e](r,r.exports,l),r.exports}l.m=n,l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=[],l.O=(t,r,s,n)=>{if(r){n=n||0;for(var i=e.length;i>0&&e[i-1][2]>n;i--)e[i]=e[i-1];e[i]=[r,s,n];return}for(var a=1/0,i=0;i<e.length;i++){for(var[r,s,n]=e[i],o=!0,c=0;c<r.length;c++)(!1&n||a>=n)&&Object.keys(l.O).every(e=>l.O[e](r[c]))?r.splice(c--,1):(o=!1,n<a&&(a=n));if(o){e.splice(i--,1);var d=s();void 0!==d&&(t=d)}}return t},t={153:0,649:0},l.O.j=e=>0===t[e],r=(e,r)=>{var s,n,[i,a,o]=r,c=0;if(i.some(e=>0!==t[e])){for(s in a)l.o(a,s)&&(l.m[s]=a[s]);if(o)var d=o(l)}for(e&&e(r);c<i.length;c++)n=i[c],l.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return l.O(d)},(s=self.webpackChunklark_codesandbox_plugin=self.webpackChunklark_codesandbox_plugin||[]).forEach(r.bind(null,0)),s.push=r.bind(null,s.push.bind(s));var a=l.O(void 0,["783","923","649"],()=>l(58));a=l.O(a)})();